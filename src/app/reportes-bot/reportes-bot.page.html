<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home-admin"></ion-back-button>
    </ion-buttons>
    <ion-title>Métricas del Chatbot</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cargarEstadisticas()">
        <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content pullingText="Desliza para actualizar" refreshingSpinner="circles"></ion-refresher-content>
  </ion-refresher>

  <ion-card class="welcome-card shadow-sm">
    <ion-card-header>
      <ion-card-subtitle>Nivel de Satisfacción</ion-card-subtitle>
      <ion-card-title>Calificación de Pacientes</ion-card-title>
    </ion-card-header>
    <ion-card-content class="ion-text-center">
      <h1 class="promedio-texto">{{ promedioBot | number:'1.1-1' }}</h1>
      
      <div class="stars-display">
        <ion-icon 
          *ngFor="let s of [1,2,3,4,5]" 
          [name]="s <= promedioBot ? 'star' : 'star-outline'" 
          [color]="s <= promedioBot ? 'warning' : 'medium'">
        </ion-icon>
      </div>
      
      <p>Total de valoraciones: <ion-badge color="primary">{{ totalVotos }}</ion-badge></p>
    </ion-card-content>
  </ion-card>

  <ion-card class="shadow-sm">
    <ion-card-header>
      <ion-card-subtitle>Análisis de Aprendizaje</ion-card-subtitle>
      <ion-card-title>Dudas No Resueltas</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p class="ion-margin-bottom">Toca una pregunta para enseñarle la respuesta al asistente:</p>
      
      <ion-list lines="full">
        <ion-item *ngIf="cargando">
          <ion-label>
            <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 40%"></ion-skeleton-text>
          </ion-label>
        </ion-item>

        <ion-item *ngFor="let duda of dudasNoResueltas" (click)="abrirEntrenador(duda)" button detail="true">
          <ion-icon name="school-outline" slot="start" color="secondary"></ion-icon>
          <ion-label>
            <h3 class="ion-text-wrap" style="font-weight: 600;">"{{ duda.pregunta_usuario }}"</h3>
            <p>{{ duda.fecha_interaccion | date:'medium' }}</p>
          </ion-label>
        </ion-item>
        
        <ion-item *ngIf="dudasNoResueltas.length === 0 && !cargando" class="ion-text-center">
          <ion-label color="success">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            ¡Excelente! El bot entiende todas las consultas.
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
</ion-content>
