<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="backUrl"></ion-back-button>
    </ion-buttons>
    <ion-title>Gestión de Horarios (ID: {{ idMedico }})</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <ion-text [color]="error ? 'danger' : 'success'" *ngIf="message || isLoading">
    <p class="ion-text-center">
      <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
      {{ message }}
    </p>
  </ion-text>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Registrar Nuevo Bloque de Horario</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <form (ngSubmit)="onCreateDisponibilidad()" #dispForm="ngForm">

        <ion-item>
          <ion-label position="floating">Día (*)</ion-label>
          <ion-input type="date" [(ngModel)]="nuevaDisponibilidad.fecha_dia" name="fecha_dia" [min]="minDate"
            required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Hora Inicio (*)</ion-label>
          <ion-input type="time" [(ngModel)]="nuevaDisponibilidad.hora_inicio" name="hora_inicio" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Hora Fin (*)</ion-label>
          <ion-input type="time" [(ngModel)]="nuevaDisponibilidad.hora_fin" name="hora_fin" required></ion-input>
        </ion-item>

        <ion-button expand="block" color="success" type="submit" class="ion-margin-top"
          [disabled]="!dispForm.valid || isSaving">
          <ion-spinner *ngIf="isSaving" name="crescent"></ion-spinner>
          {{ isSaving ? 'Guardando...' : 'Guardar Disponibilidad' }}
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>

  <ion-card class="ion-margin-top">
    <ion-card-header>
      <ion-card-title>Horarios Registrados ({{ disponibilidadExistente.length }})</ion-card-title>
    </ion-card-header>
    <ion-card-content>

      <ion-list *ngIf="disponibilidadExistente.length > 0">
        <ion-item-sliding *ngFor="let bloque of disponibilidadExistente">

          <ion-item>
            <ion-label>
              <h2>{{ bloque.fecha_dia | date: 'fullDate' }}</h2>
              <p>Horario: <strong>{{ bloque.hora_inicio }} - {{ bloque.hora_fin }}</strong></p>
            </ion-label>
          </ion-item>

          <ion-item-options side="end">
            <ion-item-option color="danger" (click)="onDeleteDisponibilidad(bloque.id_disponibilidad)">
              <ion-icon slot="icon-only" name="trash"></ion-icon>
            </ion-item-option>
          </ion-item-options>

        </ion-item-sliding>
      </ion-list>

      <ion-text color="medium" class="ion-text-center" *ngIf="disponibilidadExistente.length === 0 && !isLoading">
        <p>No hay bloques de horario registrados para este médico.</p>
      </ion-text>

    </ion-card-content>
  </ion-card>

</ion-content>